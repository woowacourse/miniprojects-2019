<!DOCTYPE html>
<html lang="ko" xmlns:th="http://www.thymeleaf.org">
<head>
	<meta charset="utf-8">
	<meta name="viewport"
	      content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no, shrink-to-fit=no">
	<title>woostagram</title>
	<meta name="robots" content="index, follow">
	
	<meta name="keyword" content="우아한테크코스, 프로그래밍, 개발자, 백엔드, 프론트엔드, Backend, Frontend, IOS, Android">
	<meta name="description" id="metaDesc" content="woostagram">
	
	<meta property="og:type" content="website">
	<meta property="og:title" content="우아한테크코스">
	<meta property="og:description" id="metaOgDesc" content="woostagram">
	<meta property="og:image" content="/images/logo/logo-thumnail-bg.jpg">
	<meta property="og:url" content="https://woowacourse.github.io/">
	
	<meta name="twitter:card" content="website">
	<meta name="twitter:title" content="우아한테크코스">
	<meta name="twitter:description" id="metaTwitterDesc" content="woostagram">
	<meta name="twitter:image" content="/images/logo/logo-thumnail-bg.jpg">
	<meta name="twitter:domain" content="https://woowacourse.github.io/">
	
	<link rel="shortcut icon" href="/images/logo/favicon.ico">
	<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/4.7.0/css/font-awesome.min.css">
	<link rel="stylesheet" href="https://cdn.jsdelivr.net/gh/lykmapipo/themify-icons@0.1.2/css/themify-icons.css">
	<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/animate.css/3.7.0/animate.min.css">
	<link rel="stylesheet" href="https://stackpath.bootstrapcdn.com/font-awesome/4.7.0/css/font-awesome.min.css"
	      integrity="sha384-wvfXpqpZZVQGK6TAh5PVlGOfQNHSoD2xbE+QkPxCAFlNEevoEH3Sl0sibVcOQVnN" crossorigin="anonymous">
	<link rel="stylesheet" href="https://stackpath.bootstrapcdn.com/bootstrap/4.1.3/css/bootstrap.min.css"
	      integrity="sha384-MCw98/SFnGE8fJT3GXwEOngsV7Zt27NXFoaoApmYm81iuXoPkFOJwJ8ERdknLPMO" crossorigin="anonymous">
	<link rel="stylesheet"
	      href="https://fonts.googleapis.com/css?family=Amiri:400,400i|Source+Sans+Pro:400,400i,600,700'">
	<link rel="stylesheet"
	      href="https://fonts.googleapis.com/css?family=Raleway:100,200,300,400,500,600,700,800&display=swap">
	<link rel="stylesheet" href="https://fonts.googleapis.com/icon?family=Material+Icons">
	<link rel="stylesheet" href="/css/app.css">
	<link rel="stylesheet" href="/css/index.css">
	<link rel="stylesheet" href="/css/zzazan.css">
</head>
<body>
<div>
	<header id="header" class="header navbar">
		<div class="header-container max-width-lg mx-auto">
			<ul class="nav-left mrg-left-0 padding-15">
				<li>
					<a href="/">
						<img class="logo desktop-view mrg-top-5" src="/images/logo/zzazanstagram.png">
					</a>
				</li>
				<li class="search-box mrg-left-20 desktop-view">
					<a class="search-toggle no-pdd-right" href="">
						<i class="search-icon ti-search pdd-right-10 font-size-25"></i>
						<i class="search-icon-close ti-close pdd-right-10 font-size-25"></i>
					</a>
				</li>
				<li class="search-input desktop-view">
					<input class="form-control mrg-top-0" type="text" placeholder="Search...">
					<div class="advanced-search">
						<div class="search-wrapper">
							<div class="pdd-vertical-10">
								<ul class="list-unstyled list-info">
									<li class="search-result-item">
										<a href="" class="text-dark">#우테코 1기</a>
									</li>
								</ul>
							</div>
						</div>
					</div>
				</li>
			</ul>
			<ul class="nav-right padding-15">
				
				<li class="">
					<a class="pointer" href="/articles/new">
						<i class="ti-pencil-alt"></i>
					</a>
				</li>
				<li>
					<a class="pointer">
						<i class="ti-heart"></i>
					</a>
				</li>
				<li>
					<a class="pointer">
						<i class="ti-user"></i>
					</a>
				</li>
			</ul>
		</div>
	</header>
	
	<div class="page-container mrg-top-120">
		<div class="main-content">
			<div class="container-fluid max-width-lg mx-auto">
				<div class="row">
					<div class="col-lg-7 mx-auto">
						
						<div th:each="article : ${articles}" class="card widget-feed no-pdd mrg-btm-70"
						     th:id="${article.id}">
							<div class="feed-header padding-15">
								<ul class="list-unstyled list-info">
									<li>
										<img class="thumb-img img-circle" th:src="${article.profileImage}" alt="">
										<div class="info">
											<a th:text="${article.nickName}" href=""
											   class="title no-pdd-vertical text-bold inline-block font-size-15"></a>
										</div>
									</li>
									<a class="pointer absolute top-10 right-0" data-toggle="dropdown"
									   aria-expanded="false">
                                        <span class="btn-icon text-dark">
                                            <i class="ti-more font-size-16"></i>
                                        </span>
									</a>
									<ul class="dropdown-menu">
										<li>
											<a class="pointer">
												<i class="ti-trash pdd-right-10 text-dark"></i>
												<span class="">게시글 삭제</span>
											</a>
										</li>
									</ul>
								</ul>
							</div>
							<div class="feed-body no-pdd">
								<img class="img-fluid" th:src="${article.image}" alt="">
							</div>
							<ul class="feed-action pdd-horizon-15 pdd-top-5">
								<li>
									<a href="">
										<i class="fa fa-heart-o font-size-25"></i>
									</a>
								</li>
								<li>
									<a href="">
										<i class="ti-comment font-size-22"></i>
									</a>
								</li>
								<li>
									<a href="">
										<i class="ti-export font-size-22"></i>
									</a>
								</li>
								<li class="float-right">
									<a href="" class="pdd-right-0">
										<i class="fa fa-bookmark-o font-size-25"></i>
									</a>
								</li>
							</ul>
							<div class="feedback-status-container pdd-horizon-15">
								<img class="mini-profile-img" src="images/default/eastjun_profile.jpg">
								<p class="no-mrg pdd-left-5 d-inline-block">
									<span class="text-bold">eastjun</span>님 외 <span class="text-bold">37</span>명이 좋아합니다.
								</p>
							</div>
							<div class="feed-footer">
								<div class="comment">
									<ul class="list-unstyled list-info pdd-horizon-5">
										<li class=" no-pdd">
											<div class="info pdd-left-15 pdd-vertical-5">
												<a th:text="${article.nickName}" href=""
												   class="title no-pdd-vertical text-bold inline-block font-size-15"></a>
												<p th:text="${article.contents}"></p>
												<p>
													<a href="" class="hashtag">#우테코1기</a>
													<a href="" class="hashtag">#베스트커플상</a>
												</p>
												<time th:text="${article.lastModifiedDate}"
												      class="font-size-8 text-gray d-block">12시간 전
												</time>
												<a class="text-gray text-bold no-mrg"
												   th:if="${#lists.size(article.commentResponses)} > 2"
												   th:text="'댓글 ' + ${#lists.size(article.commentResponses)} + '개 모두보기'"
												   href="https://www.facebook.com/photo.php?fbid=10218839206514276&set=a.3550549965490&type=3&eid=ARCGyON074Trey-lkN9xzWXkIcswd6vtGrBYRRT_6lJGY9zjDlpB2_ubHr-3V_mEsEzIHKvTppcn-GU_">댓글
													개 모두보기</a>
											</div>
										</li>
									</ul>
									<ul id="comment-list" class="list-unstyled list-info pdd-horizon-5">
										<li th:each="comment, iter : ${article.getCommentResponses()}">
											<p class="inline-block text-bold  no-mrg-btm mrg-left-15"
											   th:if="${iter.index < 2}"
											   th:text="${comment.getCommenterNickName()}">nickName</p>
											<p class="inline-block no-mrg-btm mrg-left-5"
											   th:if="${iter.index < 2}"
											   th:text="${comment.getCommentContents()}">댓글은댓글은</p>
										</li>
									</ul>
									<p class="mrg-btm-5"></p>
									<div th:id="article-id-+${article.id}" class="add-comment relative">
										<input id="comment-input" rows="1" class="form-control text-dark padding-15"
										       placeholder="댓글 달기...">
										<p class="absolute top-2 right-0">
											<button class="btn btn-default no-border text-gray btn-add-comment">게시
											</button>
										</p>
									</div>
								</div>
							</div>
						</div>
					
					
					</div>
				</div>
			</div>
		</div>
	</div>
</div>

<script src="https://code.jquery.com/jquery-3.3.1.min.js"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/pace/1.0.2/pace.min.js"></script>
<script src="https://unpkg.com/popper.js/dist/umd/popper.min.js"></script>
<script src="https://stackpath.bootstrapcdn.com/bootstrap/4.1.3/js/bootstrap.bundle.min.js"
        integrity="sha384-pjaaA8dDz/5BgdFUPX6M/9SUZv4d12SUPF0axWc+VRZkx5xU3daN+lYb49+Ax+Tl"
        crossorigin="anonymous"></script>
<script src="https://unpkg.com/axios/dist/axios.min.js"></script>
<script>
    const INDEXPAGE = (function () {

        const IndexPageController = function () {
            const indexPageService = new IndexPageService();

            const toggleSearchInput = function () {
                document.querySelector('.search-toggle').addEventListener('click', indexPageService.toggleSearchInput);
            };

            const showSearchedList = function () {
                document.querySelector(".search-input input").addEventListener("keyup", indexPageService.showSearchedList);
            };

            const addComment = function () {
                document.querySelectorAll('.btn-add-comment')
                    .forEach(el => el.addEventListener('click', indexPageService.addComment));
            };
            const toggleHeart = function () {
                document.querySelectorAll('.fa-heart-o').forEach((el) => {
                    el.addEventListener('click', indexPageService.toggleHeart);
                })
            };

            const init = function () {
                toggleSearchInput();
                showSearchedList();
                addComment();
                toggleHeart();
            };

            return {
                init: init,
            }
        };

        const IndexPageService = function () {
            const toggleSearchInput = function (event) {
                event.preventDefault();
                document.querySelector('.search-box').classList.toggle('active')
                document.querySelector(".search-input").classList.toggle("active")
                document.querySelector(".search-input input").focus()
            };

            const showSearchedList = function (event) {
                if (event.target.value.length > 0) {
                    document.querySelector(".advanced-search").classList.add("active")
                } else {
                    document.querySelector(".advanced-search").classList.remove("active")
                }
            };

            const getCommentTemplate = function (nickName, commentContents) {
                return `<li>
                              <p class="inline-block text-bold  no-mrg-btm mrg-left-15">
                                  ${nickName}
                              </p>
                              <p class="inline-block no-mrg-btm mrg-left-5">${commentContents}</p>
                        </li>`;
            }

            const addComment = function (event) {
                const message = event.target.closest("div");
                const articleId = message.id.split("-")[2];

                const inputValue = message.querySelector("input").value;
                const commentList = message.parentElement.querySelector("#comment-list");

                if (inputValue.length < 1 || inputValue.length > 100) {
                    alert('댓글은 1글자 이상 100글자 이하로 입력해 주세요');
                    return;
                }

                axios({
                    method: 'post',
                    url: '/' + articleId + '/comments/new',
                    data: {
                        contents: inputValue
                    }
                }).then(res => {
                    console.log(res);
                    const nickName = res.data.commenterNickName;
                    const commentContents = res.data.commentContents;

                    const comment = getCommentTemplate(nickName, commentContents);
                    commentList.insertAdjacentHTML('beforeend', comment);
                    document.getElementById('comment-input').value = '';
                }).catch(err => {
                    alert(err.response.data);
                });

            };

            const toggleHeart = function (event) {
                event.preventDefault();
                const articleId = event.target.closest("div").id;
                const childNodes = event.target.parentNode.parentNode.parentNode.parentNode.childNodes;
                const ddabongCountTag = childNodes[7].childNodes[3].childNodes[3];

                axios({
                    method: 'post',
                    url: '/articles/' + articleId + '/ddabongs',
                    headers: {
                        'Content-Type': 'application/json;charset=UTF-8'
                    }
                }).then(response => {
                    console.log(response)
                    ddabongCountTag.innerText = response.data.count;

                    if (response.data.clicked === false) {
                        event.target.classList.remove('fa-heart-o');
                        event.target.classList.add('fa-heart');
                        event.target.classList.add('activated-heart');
                    } else {
                        event.target.classList.remove('activated-heart');
                        event.target.classList.remove('fa-heart');
                        event.target.classList.add('fa-heart-o');
                    }
                });
            };
            return {
                toggleSearchInput: toggleSearchInput,
                showSearchedList: showSearchedList,
                addComment: addComment,
                toggleHeart: toggleHeart,
            }
        };


        const init = function () {
            const indexPageController = new IndexPageController();
            indexPageController.init();
        };

        return {
            init: init,
        }
    })();

    INDEXPAGE.init();
</script>
</body>
</html>
